{% extends "admin/change_list.html" %}

{% block object-tools-items %}
    <li style="display: flex; align-items: center; gap: 6px; margin: 5px;">
        <input type="text"
               id="scrape-url"
               placeholder="Enter URL..."
               style="font-size:13px; border:1px solid #ccc; border-radius:4px; min-width:250px;">
        <a href="#" id="scrape-btn" class="button">Scrape (API)</a>
    </li>
    {{ block.super }}
{% endblock %}

{% block extrahead %}
  {{ block.super }}
  <script>
    (function($) {
      $(function() {
        $("#scrape-btn").on("click", function(e) {
          e.preventDefault();
          const url = $("#scrape-url").val().trim();

          if (!url) {
            toastr.warning("Please enter a URL first.", "Missing URL");
            return;
          }

          $.ajax({
            url: "/api/youtubedl/scrape/",
            method: "POST",
            headers: {
              "X-CSRFToken": $("[name=csrfmiddlewaretoken]").val()
            },
            contentType: "application/json",
            data: JSON.stringify({ url: url }),
            success: function(data) {
              toastr.success(`Starting to Scrape!`, "Success");
              $("#scrape-url").val("");
            },
            error: function(xhr, status, error) {
              toastr.error("Error: " + error, "Scrape Failed");
            }
          });
        });
      });
    })(django.jQuery);
  </script>
{% endblock %}
